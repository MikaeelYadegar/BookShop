@using DatAccess.Models
@model BookShop.Models.BookDetailsViewModel
@{
    ViewData["Title"] = "Index";
}

<div class="myHeader">
    <div class="headerItems">
        <img class="headImg" src="/api/File/GetFile?filename=@Model.Book.Img" alt="@Model.Book.Title">
    </div>

    <input type="hidden" id="bookId" value="@Model.Book.Id" />
    <div class="headerItems">
        <h1>
          @Model.Book.Title
        </h1>
        <p>
           @Model.Book.Description
        </p>
        <p>
             @Model.Book.Authore.Name
        </p>

        <div class="bookPrice">
            <input id="bookIntPrice" type="hidden" value="15000">
            <strong id="bookShowPrice"> @Model.Book.Price تومان </strong>
            <div>
                تعداد :  <input id="countInput" type="number" min="1" value="1">

            </div>
        </div>

        @if(Model.Book.IsAvail)
        {
            <a  onclick="AddToBasket()" class="cartBtn atext" style="margin-top: 15px;">
                افزودن به سبد
            </a>
        }
        else

        {
            <a  class="cartBtn atext" style="margin-top: 15px;">
                اتمام موجودی
            </a>
        }


    </div>

</div>

<div class="comment-section">
<h3>نظرات کاربران</h3>

@if(Model.Comments!=null && Model.Comments.Any())
{
    <div class="comment-list">

        @foreach(var comment in Model.Comments)
        {
       <div class="comment-box">
           <div class="comment-header">
               <span class="user-name">@comment.Name</span>
               <span class="comment-date">@comment.CreatedAt.ToString("yyyy/MM/dd HH:mm")</span>
               </div>
               <p class="comment-text">@comment.Text</p>
               </div>
        }
        </div>
        <div class="sort-buttons">
            <a asp-action="Index" asp-route-id="@Model.Book.Id" asp-route-sortorder="newset">جدیدترین</a>
            <a asp-action="Index" asp-route-id="@Model.Book.Id" asp-route-sortorder="oldest">قدیمی ترین</a>
            </div>
}
else
{
   <p class="no-comments">هنوز نظری ثبت نشده است</p>
}
<h3>افزودن نظر جدید</h3>
    <form asp-action="AddComment" method="post" class="comment-form">

        <input type="hidden" name="ProductId" value="@Model.Book.Id" />
        <label>نام</label>
        <input type="text" name="Name" required />
        <label>نظر</label>
        <textarea name="Text" required></textarea>
        <button type="submit">ارسال نظر</button>
    </form>

    </div>







@section Scripts
{
    <script>
        function AddToBasket()
        {
            var bookId=document.getElementById("bookId").value;
            var qty=document.getElementById("countInput").value;
            var data={
                bookId:bookId,
                qty:qty
            };
            try{
                 fetch('/Order/AddToBasket',
                {
                    method:'POST',
                    headers:{
                        'Content-Type':'application/json'
                    },
                    body:JSON.stringify(data)
                })
                .then(responce=>responce.json())
                .then(data=>{
                    console.log('Success:',data);


                    if(data.res==false)
                    {
                 Swal.fire({
                      icon: "error",
                      title: "ثبت نام",
                      text: "ابتدا در سایت ورود کنید ",
                     
                      });
                    }

                    
                })
                .catch((error)=>{
                    console.error('Error:',error);
                });
            }
            catch
            {

            }
        }
    </script>
}
